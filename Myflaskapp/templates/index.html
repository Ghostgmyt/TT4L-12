<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATC Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='static/style.css') }}">
    <style>
        .avatar {
            max-width: 30px; /* Adjust the maximum width as needed */
            max-height: 30px; /* Adjust the maximum height as needed */
        }
        .message-container {
            margin-bottom: 10px;
            overflow: hidden;
        }
        .message-container.left .avatar {
            float: left;
            margin-right: 10px;
        }
        .message-container.left .message {
            background-color: #f1f0f0;
            border-radius: 10px;
            padding: 10px;
            float: left;
        }
        .message-container.right .avatar {
            float: right;
            margin-left: 10px;
        }
        .message-container.right .message {
            background-color: #007bff;
            color: #fff;
            border-radius: 10px;
            padding: 10px;
            float: right;
        }
    </style>
</head>
<body>
    
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">ATC Chat</h5>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="chatType">Select Chat Type:</label>
                    <select class="form-control" id="chatType">
                        <option value="(-)">
                        <option value="Departure">Departure</option>
                        <option value="Landing">Landing</option>
                        <option value="Emergencies">Emergencies</option>
                        <option value="Miscellaneous">Miscellaneous</option>
                    </select>
                </div>
                <div id="chat" style="height: 450px; overflow-y: auto;"></div>
                <div class="input-group mt-3">
                    <input id="messageInput" type="text" class="form-control" placeholder="Type your message...">
                    <div class="input-group-append">
                        <button id="sendBtn" class="btn btn-primary">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        $('#sendBtn').click(function() {
            var message = $('#messageInput').val();
            var chatType = $('#chatType').val();
            socket.emit('send_message', { message: message, chatType: chatType });
            $('#messageInput').val('');
        });

        $('#messageInput').keypress(function(event) {
            if (event.keyCode === 13) {
                $('#sendBtn').click();
            }
        });

        socket.on('receive_message', function(data) {
            var role = data.role.toLowerCase();
 var avatarSrc = role === 'atc' ? 'data:image/jpeg;base64,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' : 'https://png.pngtree.com/png-clipart/20191121/original/pngtree-pilot-icon-in-cartoon-style-png-image_5102393.jpg';
            var messageContainerClass = role === 'atc' ? 'left' : 'right';

            $('#chat').append('<div class="message-container ' + messageContainerClass + '"><img src="' + avatarSrc + '" alt="' + role.toUpperCase() + ' Avatar" class="avatar"><div class="message">' + data.message + '</div></div>');
            $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });
    </script>
</body>
</html>
